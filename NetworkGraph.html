<!DOCTYPE html>

<!--  to do: increase size of link mouseover ability
             mouseover legend text
             change orientation of tooltip 
             highlight links when you mouseover a person's name
             show two different links simultaneously 
             button to toggle 2012 data-->

<meta charset="utf-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.js"></script>
<script src="JaneD3.js"></script>
<script type="text/javascript" src="jquery.tipsy.js"></script>

<link href="tipsy.css" rel="stylesheet" type="text/css" />

<style>

.link {
  fill: none;
  stroke: #666;
  stroke-width: 1.5px;

}

.link.dorm {
  stroke: #756bb1;
}
.link.class {
  stroke: #feb24c;
}
.link.dira {
  stroke: #f03b20;
}
.link.block{
  stroke:#dd4477;
}
.link.other{
  stroke:#22aa99;
}
.node circle {
  fill: #7fcdbb;
  stroke: #fff;
  stroke-width: 1.5px;
}

text {
  font: 12px sans-serif;
  pointer-events: none;
}

.legend rect {
  fill:white;
  stroke:black;
  opacity:0.8;
}


</style>
<body>
  <!-- <button>Toggle Sophomore Year Data</button> -->
  <div id="slide1">
  <div>
    <div id="christmas_tree"> </div>
  </div>
</div>


<script>


// http://blog.thomsonreuters.com/index.php/mobile-patent-suits-graphic-of-the-day/
var links = [
{"source": "Autri", "target": "Hong", "type": 1, "comment": "Southgate"},
{"source": "Jess", "target": "Ramy", "type": 3, "comment": "DIRA"},
{"source": "Autri", "target": "Wally", "type": 2, "comment": "AMI 160: Politics and Film"},
// {"source": "Sachin", "target": "Fred", "type": 5, "comment": "O-week"},
    {"source": "Ramy", "target": "Frank", "type": 4, "comment": "Edens"},
    {"source": "Frank", "target": "Julian", "type": 4, "comment": "Edens"},
    {"source": "Ramy", "target": "Julian", "type": 4, "comment": "Edens"},
    {"source": "Jess", "target": "Brittany", "type": 4, "comment": "Craven"},
    {"source": "Autri", "target": "Justin", "type": 4, "comment": "Crowell EE"},
    {"source": "Hong", "target": "Susanna", "type": 4, "comment": "Kilgo"},
    {"source": "Sachin", "target": "Justin", "type": 4, "comment": "Crowell EE"},
    {"source": "Sachin", "target": "Autri", "type": 4, "comment": "Crowell EE"},
    {"source": "Sachin", "target": "Fred", "type": 4, "comment": "Crowell EE"},
    {"source": "Justin", "target": "Fred", "type": 4, "comment": "Crowell EE"},
    {"source": "Autri", "target": "Fred", "type": 4, "comment": "Crowell EE"}, 
{"source": "Ramy", "target": "Frank", "type": 1, "comment": "Randolph"},
{"source": "Frank", "target": "Julian", "type": 1, "comment": "Randolph"},
{"source": "Ramy", "target": "Julian", "type": 1, "comment": "Randolph"},
{"source": "Jess", "target": "Brittany", "type": 1, "comment": "Blackwell"},
{"source": "Julian", "target": "Jess", "type": 3, "comment": "DIRA"},
{"source": "Julian", "target": "Autri", "type": 3, "comment": "DIRA"},
{"source": "Autri", "target": "Ramy", "type": 3, "comment": "DIRA"},
{"source": "Julian", "target": "Ramy", "type": 3, "comment": "DIRA"},
{"source": "Jess", "target": "Autri", "type": 3, "comment": "DIRA"},
{"source": "Autri", "target": "Susanna", "type": 1, "comment": "Southgate"},
{"source": "Autri", "target": "Brian", "type": 2, "comment": "AMI 160: Politics and Film"},
{"source": "Hong", "target": "Susanna", "type": 1, "comment": "Southgate"},
{"source": "Susanna", "target": "Jane", "type": 2, "comment": "Mechanical Engineering"},
{"source": "Jane", "target": "Justin", "type": 2, "comment": "Focus"},
{"source": "Jane", "target": "Sachin", "type": 2, "comment": "Focus"},
{"source": "Sachin", "target": "Justin", "type": 2, "comment": "Focus"},
{"source": "Jane", "target": "Justin", "type": 1, "comment": "Jarvis"},
{"source": "Jane", "target": "Sachin", "type": 1, "comment": "Jarvis"},
{"source": "Sachin", "target": "Justin", "type": 1, "comment": "Jarvis"},
{"source": "Brian", "target": "Wally", "type": 2, "comment": "AMI 160: Politics and Film"}

];

var nodes = [];

// Compute the distinct nodes from the links.
links.forEach(function(link) {
  link.source = nodes[link.source] || (nodes[link.source] = {name: link.source});
  link.target = nodes[link.target] || (nodes[link.target] = {name: link.target});
});

links.forEach(function(link) {
  if ((link.type) == 1) {
    link.type = "dorm";
  } else if ((link.type) == 2) {
    link.type = "class";
  } else if ((link.type) == 3) {
    link.type = "dira";
  } else if ((link.type) == 5) {
    link.type = "other";
  } 
  else if ((link.type) == 4) {
    link.type = "block";
  } 
});

var width = 850,
    height = 600;

var force = d3.layout.force()
    .nodes(d3.values(nodes))
    .links(links)
    .size([width, height])
    .linkDistance(60)
    .charge(-1000)
    .on("tick", tick)
    .start();

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);


var classNames = ["dorm", "class", "dira"];

var link = svg.selectAll(".link")
    .data(force.links())
  .enter().append("svg:line")
    .attr("class", function(d) { return "link " + d.type})
    .attr("data-legend",function(d) { 
      if (d.type == "dorm"){
        return "freshman dorm";
      }
      if (d.type == "block"){
        return "sophomore block";
      }
      if (d.type == "dira"){
        return "DIRA";
      }
      else return d.type})
    .attr("title", function(d) {return d.comment})

    .on("mouseover", function(d) {d3.select(this)
      .style("stroke-width", "3.5px")})
    // .on("mouseover", tip.show) 
      
      
    .on("mouseout", function(d) {
      // tip.hide;
      d3.select(this)
      .style("stroke-width", "1.5px");
    });


var node = svg.selectAll(".node")
    .data(force.nodes())
  .enter().append("g")
    .attr("class", "node")
    .on("mouseover", mouseover)
    .on("mouseout", mouseout)
    .call(force.drag);

node.append("circle")
    .attr("r", 15);

node.append("text")
    .attr("x", 16)
    .attr("dy", ".35em")
    .text(function(d) { return d.name; });

function tick() {
  link
      .attr("x1", function(d) { return d.source.x; })
      .attr("y1", function(d) { return d.source.y; })
      .attr("x2", function(d) { return d.target.x; })
      .attr("y2", function(d) { return d.target.y; });

  node
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
}

function mouseover() {
  d3.select(this).select("circle").transition()
      .duration(550)
      .attr("r", 18);
  d3.select(this).select("text").transition()
      .duration(550)
      .attr("x", 19)
      // .style("stroke", "lightsteelblue")
      // .style("stroke-width", ".5px")
      .style("font", "15px sans-serif");

  // var x = d3.selectAll(".link")
  //   if (x.source === this.name){
  //     x.transition().duration(550).style("stroke-width", "3.5px");
  //   }
  // if (d3.select(this).select("text") == "Justin"){
  //   d3.select(this).select("text").transition()
  //     .duration(550)
  //     .attr("x", 30);
  //   }
  }

function mouseout() {
  d3.select(this).select("circle").transition()
      .duration(550)
      .attr("r", 15);
  d3.select(this).select("text").transition()
      .duration(750)
      .attr("x", 16)
      // .style("stroke", "lightsteelblue")
      // .style("stroke-width", ".5px")
      .style("font", "12px sans-serif");
  d3.selectAll(".link")
    .transition().duration(550)
    .style("stroke-width", "1.5px");
  }


(function() {
d3.legend = function(g) {
  g.each(function() {

    var classNames = [".dorm", ".class", ".dira"];

    var g= d3.select(this),
        items = {},
        svg = d3.select(g.property("nearestViewportElement")),
        legendPadding = g.attr("data-style-padding") || 5,
        lb = g.selectAll(".legend-box").data([true]),
        li = g.selectAll(".legend-items").data([true])

    lb.enter().append("rect").classed("legend-box",true)
    li.enter().append("g").classed("legend-items",true)

    svg.selectAll("[data-legend]").each(function() {
        var self = d3.select(this)
        // .on("mouseover", mouseover2)
        // .on("mouseout", mouseout2)
        items[self.attr("data-legend")] = {
          pos : self.attr("data-legend-pos") || this.getBBox().y,
          color : self.attr("data-legend-color") != undefined ? 
          self.attr("data-legend-color") : self.style("fill") 
          != 'none' ? self.style("fill") : self.style("stroke") 
        }

      })

    items = d3.entries(items).sort(function(a,b) { return a.value.pos-b.value.pos})

    
    li.selectAll("text")
        .data(items,function(d) { return d.key})
        .call(function(d) { d.enter().append("text")})
        .call(function(d) { d.exit().remove()})
        .attr("y",function(d,i) { return 22*i })
        .attr("x","1em")
        .on("mouseover", function(d, i) {
        if (i == 0) {
          svg.selectAll(".link" + ".dorm").style("stroke-width", "3.5px");
        }
        else if (i == 2) {
          svg.selectAll(".link" + ".class").style("stroke-width", "3.5px");
        }
        else if (i == 1) {
          svg.selectAll(".link" + ".dira").style("stroke-width", "3.5px");
        }
        })
        .on("mouseout", function(d, i) {
        if (i == 0) {
          svg.selectAll(".link" + ".dorm").style("stroke-width", "1.5px");
        }
        else if (i == 2) {
          svg.selectAll(".link" + ".class").style("stroke-width", "1.5px");
        }
        else if (i == 1) {
          svg.selectAll(".link" + ".dira").style("stroke-width", "1.5px");
        }

        // why does this one not work but the other one does?!?

        }) 
        .style("font", "16px sans-serif")
        .style("line-height","2.0") 
        .text(function(d) { ;return d.key})

    li.selectAll("circle")
        .data(items,function(d) { return d.key})
        .call(function(d) { d.enter().append("circle")})
        .call(function(d) { d.exit().remove()})
        .attr("cy",function(d,i) { return i-0.25+"em"})
        .attr("cx",0)
        .attr("r","0.4em")
        .on("mouseover", function(d, i) {
        if (i == 0) {
          svg.selectAll(".link" + ".dorm").style("stroke-width", "4px");
        }
        else if (i == 2) {
          svg.selectAll(".link" + ".class").style("stroke-width", "4px");
        }
        else if (i == 1) {
          svg.selectAll(".link" + ".dira").style("stroke-width", "3.5px");
        }
        // else if (i == 3) {
        //   svg.selectAll(".link" + ".other").style("stroke-width", "3.5px");
        // }
        else if (i == 3) {
          svg.selectAll(".link" + ".block").style("stroke-width", "4px");
        }
        })
        .on("mouseout", function(d, i) {
        if (i == 0) {
          svg.selectAll(".link" + ".dorm").style("stroke-width", "1.5px");
        }
        else if (i == 2) {
          svg.selectAll(".link" + ".class").style("stroke-width", "1.5px");
        }
        else if (i == 1) {
          svg.selectAll(".link" + ".dira").style("stroke-width", "1.5px");
        }
        // else if (i == 3) {
        //   svg.selectAll(".link" + ".other").style("stroke-width", "1.5px");
        // }
        else if (i == 3) {
          svg.selectAll(".link" + ".block").style("stroke-width", "1.5px");
        }
        })  
        .style("fill",function(d) { console.log(d.value.color);

        return d.value.color})

    
    // Reposition and resize the blackoutline box
    // var lbbox = li[0][0].getBBox()  
    // lb.attr("x",(lbbox.x-legendPadding + 600))
    //     .attr("y",(lbbox.y-legendPadding + 50))
    //     .attr("height",(lbbox.height+2*legendPadding))
    //     .attr("width",(lbbox.width+3*legendPadding))
  })
  return g
}
})()



legend = svg.append("g")
    .attr("class","legend")
    .attr("transform","translate(700,150)")
    .style("font-size","22px")
    //.style("font", "20px sans-serif")
    // .attr("data-style-padding",10)
    .call(d3.legend)

// svg.selectAll("link")
//     .enter().append("svg:circle")

$('svg .link').tipsy({ 
        gravity: 'w', 
        html: true, 
        title: function() {
          // var c = d.comment;
          var d = this.__data__;
          var c = d.comment;
          return ' ' + c + '</span>'; 
        }
      });

// title: function() {
          // var d = this.__data__, c = colors(d.i);

// d3.select('button').on('click', 2011Data.js;


</script>


<div id="slide2">
  <div>
    <div id="SecondPic"> </div>
  </div>
</div>
</body>

